{% extends "allauth/layouts/base.html" %}
{% load i18n static allauth %}

{% block head_title %}
  {% trans "Confirm Email Address" %}
{% endblock head_title %}

{% block content %}
  <div class="min-h-screen bg-base-200 flex items-center justify-center p-6 sm:p-8">
    <div class="w-full max-w-2xl">

      {# Header with Logo and Theme Toggle #}
      <div class="flex items-center justify-between mb-8">
        <a href="{% url 'landing:index' %}">
          <img
            alt="logo-dark"
            class="hidden h-5.5 dark:inline"
            src="{% static 'images/logo/logo-dark.png' %}" />
          <img
            alt="logo-light"
            class="h-5.5 dark:hidden"
            src="{% static 'images/logo/logo-light.png' %}" />
        </a>

        <button
          aria-label="Toggle Theme"
          class="btn btn-circle btn-outline border-base-300 relative overflow-hidden"
          data-theme-control="toggle">
          <span
            class="iconify lucide--sun absolute size-4.5 -translate-y-4 opacity-0 transition-all duration-300 group-data-[theme=light]/html:translate-y-0 group-data-[theme=light]/html:opacity-100"></span>
          <span
            class="iconify lucide--moon absolute size-4.5 translate-y-4 opacity-0 transition-all duration-300 group-data-[theme=dark]/html:translate-y-0 group-data-[theme=dark]/html:opacity-100"></span>
          <span
            class="iconify lucide--palette absolute size-4.5 opacity-100 group-data-[theme=dark]/html:opacity-0 group-data-[theme=light]/html:opacity-0"></span>
        </button>
      </div>

      {# Main Card #}
      <div class="card bg-base-100 card-border shadow-xl">
        <div class="card-body p-6 sm:p-8 lg:p-12">

          {% if confirmation %}

            {% if can_confirm %}
              {# SUCCESS STATE - Can Confirm #}
              <div class="flex flex-col items-center text-center">
                {# Check Badge Icon #}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-16 sm:size-20 text-primary mb-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M9 12.75 11.25 15 15 9.75M21 12c0 1.268-.63 2.39-1.593 3.068a3.745 3.745 0 0 1-1.043 3.296 3.745 3.745 0 0 1-3.296 1.043A3.745 3.745 0 0 1 12 21c-1.268 0-2.39-.63-3.068-1.593a3.746 3.746 0 0 1-3.296-1.043 3.745 3.745 0 0 1-1.043-3.296A3.745 3.745 0 0 1 3 12c0-1.268.63-2.39 1.593-3.068a3.745 3.745 0 0 1 1.043-3.296 3.746 3.746 0 0 1 3.296-1.043A3.746 3.746 0 0 1 12 3c1.268 0 2.39.63 3.068 1.593a3.746 3.746 0 0 1 3.296 1.043 3.746 3.746 0 0 1 1.043 3.296A3.745 3.745 0 0 1 21 12Z"/>
                </svg>

                <h1 class="text-2xl sm:text-3xl font-bold">
                  {% trans "Confirm Your Email Address" %}
                </h1>

                <p class="text-base-content/70 text-sm sm:text-base mt-4 max-w-md">
                  {% blocktrans with confirmation.email_address.email as email %}Please confirm that <span class="text-primary font-medium">{{ email }}</span> is your email address</span>.{% endblocktrans %}
                </p>

                {# Confirmation Form #}
                {% url 'account_confirm_email' confirmation.key as action_url %}
                <form method="post" action="{{ action_url }}" class="mt-8 w-full max-w-xs">
                  {% csrf_token %}
                  {{ redirect_field }}

                  <button type="submit" class="btn btn-primary w-full gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="m4.5 12.75 6 6 9-13.5"/>
                    </svg>
                    {% trans "Confirm Email Address" %}
                  </button>
                </form>
              </div>

            {% else %}
              {# ERROR STATE - Already Confirmed by Different Account #}
              <div class="flex flex-col items-center text-center">
                {# Exclamation Triangle Icon #}
                <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-16 sm:size-20 text-error mb-6">
                  <path stroke-linecap="round" stroke-linejoin="round" d="M12 9v3.75m-9.303 3.376c-.866 1.5.217 3.374 1.948 3.374h14.71c1.73 0 2.813-1.874 1.948-3.374L13.949 3.378c-.866-1.5-3.032-1.5-3.898 0L2.697 16.126ZM12 15.75h.007v.008H12v-.008Z"/>
                </svg>

                <h1 class="text-2xl sm:text-3xl font-bold">
                  {% trans "Email Already Confirmed" %}
                </h1>

                <p class="text-base-content/70 text-sm sm:text-base mt-4 max-w-md">
                  {% blocktrans with confirmation.email_address.email as email %}Unable to confirm <span class="text-error font-medium">{{ email }}</span> because it is already confirmed by a different account.{% endblocktrans %}
                </p>

                {# Go to Sign In Button #}
                <div class="mt-8">
                  <a href="{% url 'account_login' %}" class="btn btn-primary gap-2">
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                      <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 9V5.25A2.25 2.25 0 0 0 13.5 3h-6a2.25 2.25 0 0 0-2.25 2.25v13.5A2.25 2.25 0 0 0 7.5 21h6a2.25 2.25 0 0 0 2.25-2.25V15m3 0 3-3m0 0-3-3m3 3H9"/>
                    </svg>
                    {% trans "Go to Sign In" %}
                  </a>
                </div>
              </div>
            {% endif %}

          {% else %}
            {# EXPIRED STATE - Invalid or Expired Link #}
            <div class="flex flex-col items-center text-center">
              {# Clock Icon #}
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-16 sm:size-20 text-warning mb-6">
                <path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 1 1-18 0 9 9 0 0 1 18 0Z"/>
              </svg>

              <h1 class="text-2xl sm:text-3xl font-bold">
                {% trans "Confirmation Link Expired" %}
              </h1>

              <p class="text-base-content/70 text-sm sm:text-base mt-4 max-w-md">
                {% trans "This email confirmation link has expired or is invalid." %}
              </p>

              {# Request New Confirmation Button #}
              {% url 'account_email' as email_url %}
              <div class="mt-8">
                <a href="{{ email_url }}" class="btn btn-primary gap-2">
                  <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
                    <path stroke-linecap="round" stroke-linejoin="round" d="M21.75 6.75v10.5a2.25 2.25 0 0 1-2.25 2.25h-15a2.25 2.25 0 0 1-2.25-2.25V6.75m19.5 0A2.25 2.25 0 0 0 19.5 4.5h-15a2.25 2.25 0 0 0-2.25 2.25m19.5 0v.243a2.25 2.25 0 0 1-1.07 1.916l-7.5 4.615a2.25 2.25 0 0 1-2.36 0L3.32 8.91a2.25 2.25 0 0 1-1.07-1.916V6.75"/>
                  </svg>
                  {% trans "Request New Confirmation" %}
                </a>
              </div>
            </div>
          {% endif %}

        </div>
      </div>

      {# Footer Links #}
      <div class="text-center mt-6 text-sm text-base-content/60">
        <p>
          {% trans "Need help?" %}
          <a href="{% url 'landing:index' %}" class="text-primary hover:underline">
            {% trans "Contact Support" %}
          </a>
        </p>
      </div>

    </div>
  </div>
{% endblock content %}
