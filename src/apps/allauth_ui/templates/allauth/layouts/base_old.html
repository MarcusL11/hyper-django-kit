{% load i18n %}
{% load static tailwind_tags cotton %}
{% load allauth_ui %}
{% get_current_language as LANGUAGE_CODE %}
<!DOCTYPE html>
<html lang="{{ LANGUAGE_CODE }}" data-theme="light">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block head_title %}{% endblock head_title %}</title>
    {% block extra_head %}
    {% endblock extra_head %}
    {% tailwind_css %}
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

    <!-- Theme Initialization Script - Loads before page renders -->
    <script>
        // Initialize theme from localStorage before page renders to prevent flash
        (function() {
            try {
                const savedTheme = localStorage.getItem('theme');
                if (savedTheme) {
                    document.documentElement.setAttribute('data-theme', savedTheme);
                }
            } catch (e) {
                console.error('Failed to load theme from localStorage:', e);
            }
        })();
    </script>
  </head>

  <body class="min-h-screen flex flex-col">
    {% comment %}
    {% if messages %}
      <div id="messages">
        {% for message in messages %}<div class="alert alert-info mb-2">{{ message }}</div>{% endfor %}
      </div>
      <script>
        setTimeout(function() {
          var messages = document.getElementById('messages');
          if (messages) {messages.style.display = 'none';}}, 4000); // 4 seconds
      </script>
    {% endif %}
    {% endcomment %}

    <!-- Navigation Bar -->
    <c-navbar />

    {% block body %}
    <!-- Content Container -->
    <div class="relative flex-1 flex items-center justify-center" style="z-index: 2;">
      <div class="w-full">
        {% block content %}
        {% endblock content %}
        </div>
      </div>

      <!-- Footer Links -->
      <div class="relative pb-4" style="z-index: 2;">
        <div class="mx-auto [&_a]:link text-sm flex flex-col md:flex-row items-center justify-center gap-3 mt-3">
          {% if user.is_authenticated %}
          {% url 'account_email' as email_url %}
          {% if email_url %}
          <a href="{{ email_url }}">{% trans "Change Email" %}</a>
          {% endif %}
          {% url 'account_change_password' as change_password_url %}
          {% if change_password_url %}
          <a href="{{ change_password_url }}">{% trans "Change Password" %}</a>
          {% endif %}
          {% url 'mfa_index' as mfa_url %}
          {% if mfa_url %}
          <a href="{{ mfa_url }}">{% trans "Two-Factor Authentication" %}</a>
          {% endif %}
          {% url 'usersessions_list' as usersessions_list_url %}
          {% if usersessions_list_url %}
          <a href="{{ usersessions_list_url }}">{% trans "Sessions" %}</a>
          {% endif %}
          {% url 'account_logout' as logout_url %}
          {% if logout_url %}
          <a href="{{ logout_url }}">{% trans "Sign Out" %}</a>
          {% endif %}
          {% else %}
          {% url 'account_login' as login_url %}
          {% if login_url %}
          <a href="{{ login_url }}">{% trans "Sign In" %}</a>
          {% endif %}
          {% url 'account_signup' as signup_url %}
          {% if signup_url %}
          <a href="{{ signup_url }}">{% trans "Sign Up" %}</a>
          {% endif %}
          {% endif %}
        </div>
      </div>
    {% endblock body %}
    {% block extra_body %}
    {% endblock extra_body %}
    <!-- Centralized JavaScript -->
    <script src="{% static 'js/theme_switcher.js' %}"></script>
    <script src="{% static 'js/toast.js' %}"></script>
  </body>
</html>
