{% extends "blogs/base.html" %}
{% load cotton markdown_extras %}

{% block title %}{{ blog.get_meta_title }} - {{ block.super }}{% endblock %}

{% block meta_description %}{{ blog.get_meta_description }}{% endblock %}

{% block extra_head %}
<!-- Open Graph -->
<meta property="og:title" content="{{ blog.get_meta_title }}">
<meta property="og:description" content="{{ blog.get_meta_description }}">
<meta property="og:type" content="article">
{% if blog.og_image %}
<meta property="og:image" content="{{ blog.og_image.url }}">
{% elif blog.featured_image %}
<meta property="og:image" content="{{ blog.featured_image.url }}">
{% endif %}
{% if blog.canonical_url %}
<link rel="canonical" href="{{ blog.canonical_url }}">
{% endif %}

<!-- Article metadata -->
<meta property="article:published_time" content="{{ blog.date|date:'c' }}">
<meta property="article:author" content="{{ blog.author.get_full_name|default:blog.author.username }}">
{% for category in blog.categories.all %}
<meta property="article:tag" content="{{ category.name }}">
{% endfor %}
{% endblock %}

{% block content %}

<c-layout._page bg_class="bg-gradient-to-b from-base-100 to-transparent">

  {% if is_preview %}
  <!-- Preview Banner -->
  <div class="bg-warning text-warning-content py-3">
    <c-layout._container max_width="max-w-7xl" extra_class="flex items-center justify-center gap-2">
      <span class="iconify lucide--eye size-5"></span>
      <span class="font-medium">Preview Mode</span>
      <span class="text-sm">This post is not yet published</span>
    </c-layout._container>
  </div>
  {% endif %}

  <!-- Article Header -->
  <article class="py-12 md:py-6">
    <c-layout._container max_width="max-w-4xl">

      <!-- Breadcrumbs -->
      <div class="breadcrumbs text-sm mb-4">
        <ul>
          <li><a href="{% url 'landing:index' %}">Home</a></li>
          <li><a href="{% url 'blogs:blog_list' %}">Blog</a></li>
          <li class="text-base-content">{{ blog.title|truncatewords:5 }}</li>
        </ul>
      </div>

      <!-- Title -->
      <h1 class="text-3xl md:text-4xl lg:text-5xl font-heading font-bold mb-6 leading-tight">
        {{ blog.title }}
      </h1>

      <!-- Meta Info -->
      <div class="flex flex-wrap items-center gap-4 text-base-content mb-8">
        <!-- Author -->
        <span class="font-medium text-base-content">Written by: {{ blog.author.get_full_name|default:blog.author.username }}</span>
        <span class="text-base-content/50" aria-hidden="true">|</span>

        <!-- Date -->
        <div class="flex items-center gap-1">
          <span class="iconify lucide--calendar size-4"></span>
          <time datetime="{{ blog.date|date:'Y-m-d' }}">{{ blog.date|date:"F j, Y" }}</time>
        </div>

        <!-- Reading time estimate (rough: 200 words/min) -->
        {% with word_count=blog.content|wordcount %}
        <span class="text-base-content/50" aria-hidden="true">|</span>
        <div class="flex items-center gap-1">
          <span class="iconify lucide--clock size-4"></span>
          <span>{{ word_count|reading_time }} min read</span>
        </div>
        {% endwith %}
        
      <!-- Tags / Categories Footer -->
      {% if blog.categories.exists %}
      <span class="text-base-content/50" aria-hidden="true">|</span>
      <div class="flex flex-wrap items-center gap-3">
        <span class="text-base-content font-medium">Categories:</span>
        {% for category in blog.categories.all %}
        <a href="{% url 'blogs:blog_category_list' slug=category.slug %}"
           class="btn btn-sm btn-ghost gap-1">
          {{ category.name }}
        </a>
        {% endfor %}
      </div>
      {% endif %}

      <!-- Featured Image -->
      {% if blog.featured_image %}
      <figure class="mb-8 rounded-2xl overflow-hidden shadow-xl">
        <img src="{{ blog.featured_image.url }}"
             alt="{{ blog.title }}"
             class="w-full h-auto object-cover aspect-video">
      </figure>
      {% endif %}

      <!-- Content -->
      <div class="prose prose-lg max-w-none
                  prose-headings:font-heading prose-headings:text-base-content
                  prose-p:text-base-content prose-p:font-body prose-p:leading-relaxed
                  prose-a:text-primary prose-a:no-underline hover:prose-a:underline
                  prose-strong:text-base-content
                  prose-blockquote:border-primary prose-blockquote:bg-base-200/50 prose-blockquote:py-1 prose-blockquote:px-4 prose-blockquote:rounded-r-lg
                  prose-code:bg-base-200 prose-code:px-1.5 prose-code:py-0.5 prose-code:rounded prose-code:before:content-none prose-code:after:content-none
                  prose-pre:bg-base-300 prose-pre:shadow-inner
                  prose-img:rounded-xl prose-img:shadow-lg
                  prose-ul:list-disc prose-ol:list-decimal
                  prose-li:text-base-content prose-li:marker:text-primary">
        {{ blog.content|markdown }}
      </div>

      <!-- Share Section -->
      <div class="divider my-12"></div>
      <div class="flex flex-wrap items-center justify-between gap-4">
        <span class="text-base-content font-medium">Share this post:</span>
        <div class="flex gap-2">
          <a href="https://twitter.com/intent/tweet?text={{ blog.title|urlencode }}&url={{ request.build_absolute_uri }}"
             target="_blank" rel="noopener noreferrer"
             class="btn btn-circle">
          </a>
          <a href="https://www.facebook.com/sharer/sharer.php?u={{ request.build_absolute_uri }}"
             target="_blank" rel="noopener noreferrer"
             class="btn btn-circle">
          </a>
          <a href="https://www.linkedin.com/shareArticle?mini=true&url={{ request.build_absolute_uri }}&title={{ blog.title|urlencode }}"
             target="_blank" rel="noopener noreferrer"
             class="btn btn-circle">
          </a>
          <button onclick="navigator.clipboard.writeText('{{ request.build_absolute_uri }}')"
                  class="btn btn-circle tooltip" data-tip="Copy link">
          </button>
        </div>
      </div>

    </c-layout._container>
  </article>

  <!-- Back to Blog -->
  <c-layout._section py_class="py-8" max_width="max-w-4xl">
    <a href="{% url 'blogs:blog_list' %}" class="btn btn-outline gap-2">
      Back to Blog
    </a>
  </c-layout._section>

</c-layout._page>

{% endblock %}
