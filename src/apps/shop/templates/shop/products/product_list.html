{% extends 'shop/base_product_list.html' %}
{% load static partials %}

{% block content %}
<div class="min-h-screen bg-base-100">

  <!-- Main Content -->
  <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-8 sm:py-12 max-w-7xl">

    <!-- Controls Bar -->
    <div class="flex flex-col sm:flex-row items-center justify-between mb-6 sm:mb-8 gap-4">

      <!-- Pagination (if multiple pages) -->
      {% if page_obj.paginator.num_pages > 1 %}
      <div class="join">
        <!-- Previous Button -->
        {% if page_obj.has_previous %}
        <a href="?page={{ page_obj.previous_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="btn btn-sm join-item" aria-label="Previous page">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
          </svg>
        </a>
        {% else %}
        <button class="btn btn-sm btn-disabled join-item" aria-label="Previous page" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="M15.75 19.5 8.25 12l7.5-7.5" />
          </svg>
        </button>
        {% endif %}

        <!-- Page Indicator -->
        <button class="btn btn-sm join-item pointer-events-none">
          <span class="hidden sm:inline">Page</span> {{ page_obj.number }} <span class="hidden sm:inline">of {{ page_obj.paginator.num_pages }}</span>
        </button>

        <!-- Next Button -->
        {% if page_obj.has_next %}
        <a href="?page={{ page_obj.next_page_number }}{% if request.GET.category %}&category={{ request.GET.category }}{% endif %}{% if request.GET.sort %}&sort={{ request.GET.sort }}{% endif %}"
           class="btn btn-sm join-item" aria-label="Next page">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
          </svg>
        </a>
        {% else %}
        <button class="btn btn-sm btn-disabled join-item" aria-label="Next page" disabled>
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-4">
            <path stroke-linecap="round" stroke-linejoin="round" d="m8.25 4.5 7.5 7.5-7.5 7.5" />
          </svg>
        </button>
        {% endif %}
      </div>
      {% else %}
      <div></div> <!-- Spacer when no pagination -->
      {% endif %}

      <!-- Filter & Sort Button -->
      <label for="layout-rightbar-drawer" class="btn btn-sm btn-ghost gap-2" aria-label="Open filters">
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-5">
          <path stroke-linecap="round" stroke-linejoin="round" d="M10.5 6h9.75M10.5 6a1.5 1.5 0 1 1-3 0m3 0a1.5 1.5 0 1 0-3 0M3.75 6H7.5m3 12h9.75m-9.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-3.75 0H7.5m9-6h3.75m-3.75 0a1.5 1.5 0 0 1-3 0m3 0a1.5 1.5 0 0 0-3 0m-9.75 0h9.75" />
        </svg>
        <span class="hidden sm:inline">Filter & Sort</span>
      </label>
    </div>

    <!-- Product Grid -->
    {% partialdef product-grid-partial inline %}
    <div id="product-grid-container">
      {% if products %}
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4 sm:gap-6">
        {% for product in products %}
        <div class="group">
          <div class="card card-border bg-base-100 shadow-sm hover:shadow-xl transition-all duration-300 h-full flex flex-col">

            <!-- Product Image -->
            <figure class="aspect-square overflow-hidden">
              <img src="{{ product.cover_image.url }}"
                   alt="{{ product.name }}"
                   class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-300"
                   width="400"
                   height="400" />
            </figure>

            <!-- Product Details -->
            <div class="card-body flex-grow flex flex-col">
              <h2 class="card-title text-base sm:text-lg line-clamp-2">
                {{ product.name }}
              </h2>
              <p class="text-sm text-base-content/70 line-clamp-2 flex-grow">
                {{ product.description }}
              </p>

              <!-- Price and Category -->
              <div class="flex items-center justify-between mt-auto pt-4">
                <span class="text-xl sm:text-2xl font-semibold text-primary">{{ product.price }}</span>
                {% if product.category %}
                <span class="badge badge-sm badge-outline">{{ product.category.name }}</span>
                {% endif %}
              </div>

              <!-- Badges -->
              {% if product.is_new or product.is_popular %}
              <div class="flex gap-2 mt-2">
                {% if product.is_new %}
                <div class="badge badge-secondary badge-sm">NEW</div>
                {% endif %}
                {% if product.is_popular %}
                <div class="badge badge-primary badge-sm">POPULAR</div>
                {% endif %}
              </div>
              {% endif %}

              <!-- View Product Button -->
              <div class="card-actions mt-4">
                <a href="{% url 'shop:product_detail' slug=product.slug|slugify %}" class="btn btn-primary btn-block btn-sm">
                  View Product
                </a>
              </div>
            </div>
          </div>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <!-- Empty State -->
      <div class="hero min-h-[50vh]">
        <div class="hero-content text-center">
          <div class="max-w-md space-y-4">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="size-16 mx-auto text-base-content/30">
              <path stroke-linecap="round" stroke-linejoin="round" d="M20.25 7.5l-.625 10.632a2.25 2.25 0 01-2.247 2.118H6.622a2.25 2.25 0 01-2.247-2.118L3.75 7.5M10 11.25h4M3.375 7.5h17.25c.621 0 1.125-.504 1.125-1.125v-1.5c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125v1.5c0 .621.504 1.125 1.125 1.125z" />
            </svg>
            <h3 class="text-2xl font-semibold">No Products Found</h3>
            <p class="text-base-content/70">
              No products match your current filters. Try adjusting your selection.
            </p>
          </div>
        </div>
      </div>
      {% endif %}
    </div>
    {% endpartialdef product-grid-partial %}

  </div>
</div>
{% endblock content %}
